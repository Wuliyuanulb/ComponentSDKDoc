

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Process Group and Communication Backend &mdash; Component SDK  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/my_theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
        <script type="text/javascript" src="../../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="MPI" href="mpi.html" />
    <link rel="prev" title="Distributed Component" href="../distributed_component.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Component SDK
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts.html">Concepts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../components.html">Components</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../command_component.html">Command Component</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../distributed_component.html">Distributed Component</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../distributed_component.html#overview">Overview</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../distributed_component.html#launcher">Launcher</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Process Group and Communication Backend</a></li>
<li class="toctree-l4"><a class="reference internal" href="#distributed-training-launcher">Distributed Training Launcher</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../distributed_component.html#supported-launchers">Supported Launchers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../parallel_component.html">Parallel Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hdi_component.html">HDInsight Component</a></li>
<li class="toctree-l2"><a class="reference internal" href="../component-spec-definition.html">Definition of component spec</a></li>
<li class="toctree-l2"><a class="reference internal" href="../component-spec-topics.html">Component spec advanced topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use-component-spec-schema-in-vscode.html">How to use component spec schema in vscode</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../CHANGELOG.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sdk_reference.html">SDK Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../links.html">Useful Links</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Component SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../components.html">Components</a> &raquo;</li>
        
          <li><a href="../distributed_component.html">Distributed Component</a> &raquo;</li>
        
      <li>Process Group and Communication Backend</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/components/distributed_component/launcher.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="process-group-and-communication-backend">
<h1>Process Group and Communication Backend<a class="headerlink" href="#process-group-and-communication-backend" title="Permalink to this headline">¶</a></h1>
<p>The backbone of any distributed training is based on a group of processes that knows each other and
can communicate with each other using a backend. For PyTorch, the process group is created by calling <code class="docutils literal"><span class="pre">torch.distributed.init_process_group</span></code> in <strong>all distributed processes</strong> to collectively form a process group.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">distributed</span><span class="o">.</span><span class="n">init_process_group</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="s1">&#39;nccl&#39;</span><span class="p">,</span> <span class="n">init_method</span><span class="o">=</span><span class="s1">&#39;env://&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>The most common backend used are <strong>mpi</strong>, <strong>nccl</strong> and <strong>gloo</strong>. For GPU based training <strong>nccl</strong> is strongly preferred and should be used whenever possible. <code class="docutils literal"><span class="pre">Init_method</span></code> specifies how each processes can discover each other and initialize as well as verify the process group using the communication backend. By default PyTorch will look for environment variables. The following is a list of key environment variables, documented <a class="reference external" href="https://pytorch.org/docs/stable/distributed.html#torch.distributed.init_process_group">here</a>.</p>
<ul class="simple">
<li>MASTER_PORT - required; has to be a free port on machine with rank 0</li>
<li>MASTER_ADDR - required; address of rank 0 node</li>
<li>WORLD_SIZE - required; can be set either here, or in a call to init method. The total number of processes. This should be equal to the number of devices (GPU) used for distributed training.</li>
<li>RANK - required; can be set either here, or in a call to init method. The rank (0 to world_size - 1) of the current process in the process group.</li>
</ul>
<p>Beyond these, many application will need the following</p>
<ul class="simple">
<li>LOCAL_RANK - the relative rank within the node. This information is useful for example many operations such as data preparation only should be performed once per node &#8212; usually on local_rank = 0.</li>
<li>NODE_RANK - the relative rank for the node among all the nodes.</li>
</ul>
<blockquote>
<div><p><strong>Note</strong>:</p>
<ul class="simple">
<li>RANK can be inferred by NODE_RANK and LOCAL_RANK. NODE_RANK is often used by utility launcher script (such as <a class="reference external" href="https://github.com/pytorch/pytorch/blob/master/torch/distributed/launch.py">torch.distributed.launch</a>) that can created multiple processes on the same node.</li>
<li>LOCAL_RANK and RANK are both process level environment variables which are not set for the node but for the process.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="distributed-training-launcher">
<h1>Distributed Training Launcher<a class="headerlink" href="#distributed-training-launcher" title="Permalink to this headline">¶</a></h1>
<p>Users rarely launch all distributed processes manually and often rely on a utility launcher. There are 3 types of utility launchers.</p>
<ol class="simple">
<li><strong>Per-process-launcher</strong>: the system will launch all distributed processes for users, with all the relevant information (e.g. environment variables) to set up process groups.</li>
<li><strong>Per-node-launcher</strong>: the utility launcher will launch processes on a given node. User is responsible to run the launcher from multiple nodes and provide global information such as WORLD_SIZE and MASTER_ADDR, MASTER_PORT. Locally within each node, RANK and LOCAL_RANK is set up by the launcher, with user provided NODE_RANK. <code class="docutils literal"><span class="pre">torch.distributed.launch</span></code> belongs to this category, as well as <a class="reference external" href="https://pytorch-lightning.readthedocs.io/en/stable/trainer.html#accelerator">pytorch-lightning Trainer using ddp accelerator</a>.</li>
<li><strong>Head-node-launcher</strong>: User run launcher at the head provide information about the cluster (e.g. a hostfile) and launcher arguments, the training script and arguments for the training script. Three examples of head node launcher are <a class="reference external" href="https://www.open-mpi.org/doc/v4.0/man1/mpirun.1.php">mpirun</a>, <a class="reference external" href="https://www.deepspeed.ai/getting-started/#launching-deepspeed-training">DeepSpeed launcher</a> and <a class="reference external" href="https://horovod.readthedocs.io/en/stable/running_include.html">Horovodrun</a>.</li>
</ol>
<p>This three categories of launchers are named with respect to user experience. Per-process-launcher means user does not need to do extra launching effort, per-node-launcher means user need to be able to run launcher script on every node, and head-node-launcher requires user to get on a headnode with cluster information usually in a hostfile. There are no fundamental differences between the three types of launchers and eventually what matters is the process group getting initiated with the proper backend. Behind the scene a head-node-launcher is often used on behalf of the user by the system so user are exposed to a per-process-launcher experience. Head-node-launcher is often implemented as a wrapper of per-node-launcher.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mpi.html" class="btn btn-neutral float-right" title="MPI" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../distributed_component.html" class="btn btn-neutral float-left" title="Distributed Component" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021, Microsoft

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>